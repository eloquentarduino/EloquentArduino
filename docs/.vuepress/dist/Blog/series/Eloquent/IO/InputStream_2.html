<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>InputStream . Part2 | EloquentArduino</title>
    <meta name="description" content="A collection of eloquent APIs for Arduino">
    
    
    <link rel="preload" href="/EloquentArduino/assets/css/0.styles.565b6e10.css" as="style"><link rel="preload" href="/EloquentArduino/assets/js/app.1470b0bf.js" as="script"><link rel="preload" href="/EloquentArduino/assets/js/7.71090359.js" as="script"><link rel="prefetch" href="/EloquentArduino/assets/js/10.d18d8445.js"><link rel="prefetch" href="/EloquentArduino/assets/js/11.1fcda93d.js"><link rel="prefetch" href="/EloquentArduino/assets/js/12.71c3100b.js"><link rel="prefetch" href="/EloquentArduino/assets/js/13.28c14d81.js"><link rel="prefetch" href="/EloquentArduino/assets/js/14.e2b02aab.js"><link rel="prefetch" href="/EloquentArduino/assets/js/15.b6727a3b.js"><link rel="prefetch" href="/EloquentArduino/assets/js/16.c22cc59a.js"><link rel="prefetch" href="/EloquentArduino/assets/js/17.301f8078.js"><link rel="prefetch" href="/EloquentArduino/assets/js/18.9bfef7ce.js"><link rel="prefetch" href="/EloquentArduino/assets/js/19.7e08e6a1.js"><link rel="prefetch" href="/EloquentArduino/assets/js/2.c3c2ef99.js"><link rel="prefetch" href="/EloquentArduino/assets/js/20.86b3dfc4.js"><link rel="prefetch" href="/EloquentArduino/assets/js/21.5d82e070.js"><link rel="prefetch" href="/EloquentArduino/assets/js/3.aef08e8b.js"><link rel="prefetch" href="/EloquentArduino/assets/js/4.682a9bca.js"><link rel="prefetch" href="/EloquentArduino/assets/js/5.0d52884a.js"><link rel="prefetch" href="/EloquentArduino/assets/js/6.20135cc5.js"><link rel="prefetch" href="/EloquentArduino/assets/js/8.c252aaeb.js"><link rel="prefetch" href="/EloquentArduino/assets/js/9.2147c3b5.js">
    <link rel="stylesheet" href="/EloquentArduino/assets/css/0.styles.565b6e10.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/EloquentArduino/" class="home-link router-link-active"><!----> <span class="site-name">EloquentArduino</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/EloquentArduino/Blog.html" class="nav-link">Blog</a></div><div class="nav-item"><a href="/EloquentArduino/docs.html" class="nav-link">Docs</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/EloquentArduino/Blog.html" class="nav-link">Blog</a></div><div class="nav-item"><a href="/EloquentArduino/docs.html" class="nav-link">Docs</a></div> <!----></nav>  <!----> </div> <div class="page"> <div class="content"><h1 id="io-inputstream-part2"><a href="#io-inputstream-part2" aria-hidden="true" class="header-anchor">#</a> IO::InputStream . Part2</h1> <p>In <a href="/EloquentArduino/Blog/series/Eloquent/IO/InputStream_1.html">Part 1</a> I introduced InputStreams and Transformers.
In this second part we'll see some more examples and learn some more in depth.</p> <h2 id="available-inputstream"><a href="#available-inputstream" aria-hidden="true" class="header-anchor">#</a> Available InputStream</h2> <p>This will be a (hopefully) growing list of the available InputStreams,
with a short description of the use cases of each.</p> <h3 id="analogpininputstream"><a href="#analogpininputstream" aria-hidden="true" class="header-anchor">#</a> <code>AnalogPinInputStream</code></h3> <p>Generates values from an analog pin; it's just a wrapper around <code>analogRead()</code>.
Use this when working with analog sensors.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>AnalogPinInputStream <span class="token function">potentiometer</span><span class="token punctuation">(</span>A0<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>potentiometer<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// is equivalent to</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">analogRead</span><span class="token punctuation">(</span>A0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="arrayinputstream"><a href="#arrayinputstream" aria-hidden="true" class="header-anchor">#</a> <code>ArrayInputStream</code></h3> <p>Transforms an array to a stream. It will emit the values in the array, one by one.
Use this when you have an array you want to process using the transformer
interface.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> array<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
ArrayInputStream <span class="token function">stream</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assertTrue</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertTrue</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertTrue</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertTrue</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertTrue</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertTrue</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> NaN<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="assignableinputstream-aka-echoinputstream"><a href="#assignableinputstream-aka-echoinputstream" aria-hidden="true" class="header-anchor">#</a> <code>AssignableInputStream</code> (aka <code>EchoInputStream</code>)</h3> <p>This stream emits the values you assign to it. It's a generic stream that
lets you apply the InputStream interface to whatever variable you have.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>AssignableInputStream streamX<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    streamX<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">Abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">float</span> ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">;</span>

    M5<span class="token punctuation">.</span>MPU6886<span class="token punctuation">.</span><span class="token function">getAccelData</span><span class="token punctuation">(</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">)</span><span class="token punctuation">;</span>
    streamX <span class="token operator">=</span> ax<span class="token punctuation">;</span>

    <span class="token function">assertTrue</span><span class="token punctuation">(</span>streamX<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">abs</span><span class="token punctuation">(</span>ax<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="a-note-about-chaining"><a href="#a-note-about-chaining" aria-hidden="true" class="header-anchor">#</a> A note about chaining</h3> <p>You may have noticed that in the examples I used the <code>new</code> construct to add the transformers
to the input stream. I suggest to use this pattern because:</p> <ol><li>it's readable</li> <li>it forces to use &quot;one-off&quot; transformers</li></ol> <p>The 2^nd point needs some explanation: to do it's magic, the chaining uses
pointers to the transformers to create a sort of linked list, without an actual list.
This means that you can't reuse transformers in multiple places, since it will break
chaining. Also, some transformers have internal state that need to be kept consistent.
If you create a transformer just inside the <code>then()</code>, you'll be at safe.</p> <div class="language-c extra-class"><pre class="language-c"><code>AnalogPinInputStream <span class="token function">potentiometer1</span><span class="token punctuation">(</span>A0<span class="token punctuation">)</span><span class="token punctuation">;</span>
AnalogPinInputStream <span class="token function">potentiometer2</span><span class="token punctuation">(</span>A1<span class="token punctuation">)</span><span class="token punctuation">;</span>
AnalogPinInputStream <span class="token function">potentiometer3</span><span class="token punctuation">(</span>A2<span class="token punctuation">)</span><span class="token punctuation">;</span>
ExponentialSmoothing <span class="token function">smoothing</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Map <span class="token function">map</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// THIS WILL NOT WORK AS EXPECTED</span>
    potentiometer1
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>smoothing<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

    potentiometer2
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>smoothing<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// NASTY THINGS WILL HAPPEN NOW</span>
    potentiometer3
             <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>map<span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>smoothing<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>potentiomenter1<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>potentiomenter2<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>potentiomenter3<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <p>In <a href="#">Part 3</a> we'll look at the available Transformers.</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/EloquentArduino/assets/js/app.1470b0bf.js" defer></script><script src="/EloquentArduino/assets/js/7.71090359.js" defer></script>
  </body>
</html>
